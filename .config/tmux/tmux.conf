# General
set -ga terminal-overrides ",alacritty:RGB,xterm-256color:RGB"
set -g extended-keys always
set -g extended-keys-format csi-u
set -g allow-passthrough all
set -g focus-events on
set -g history-limit 10000
set -g escape-time 0
set -g repeat-time 500
set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on

# Unbind awkward keys
unbind p
unbind z
unbind C-b

# Prefix
set -g prefix M-a
bind M-a send-prefix

# Vi
setw -g mode-keys vi
bind -n M-c copy-mode \; send -X jump-backward $
bind -T copy-mode-vi M-c send -X cancel
bind -T copy-mode-vi C-c send -X cancel
# bind -T copy-mode-vi Escape send -X cancel
bind -T copy-mode-vi i send -X cancel

# Vi Selection
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi $ send -X end-of-line \; send -X cursor-left
bind -T copy-mode-vi C-w send -X select-word

# Vi Copy-paste
bind -T copy-mode-vi C-S-C send -X copy-pipe-and-cancel 'xclip -i -selection clipboard'
bind -T copy-mode-vi y send -X copy-pipe-and-cancel 'xclip -i -selection clipboard'
bind -T copy-mode-vi Y send -X start-of-line \; send -X begin-selection \; send -X  \; send -X end-of-line \; send -X cursor-left \; send -X copy-pipe-and-cancel 'xclip -i -selection clipboard'
bind -T copy-mode-vi C-y send -X select-word \; send -X copy-pipe-and-cancel 'xclip -i -selection clipboard'

# Search
bind -T copy-mode-vi / copy-mode \; command-prompt -i -p "(search up)" "send -X search-backward-incremental \"%%%\""
bind -n M-/ copy-mode \; command-prompt -i -p "(search up)" "send -X search-backward-incremental \"%%%\""
bind -T copy-mode-vi N send -X search-again
bind -T copy-mode-vi n send -X search-reverse

# Mouse support
set -g mouse on
bind -T copy-mode-vi WheelUpPane send -N3 -X scroll-up
bind -T copy-mode-vi WheelDownPane send -N3 -X scroll-down
bind -T copy-mode-vi C-WheelUpPane send -X page-up
bind -T copy-mode-vi C-WheelDownPane send -X page-down

# Reload config
bind -n M-R source-file ~/.config/tmux/tmux.conf \; display "tmux.conf Reloaded!"

# Pane actions
bind -n M-s split-window -v -c "#{pane_current_path}"
bind -n M-v split-window -h -c "#{pane_current_path}"
bind -n M-q kill-pane

# Window actions
bind -n M-, previous-window
bind -n M-. next-window
bind -n M-< swap-window -d -t -
bind -n M-> swap-window -d -t +
bind -n C-Tab last-window
bind -n M-0 select-window -t :0
bind -n M-1 select-window -t :1
bind -n M-2 select-window -t :2
bind -n M-3 select-window -t :3
bind -n M-4 select-window -t :4
bind -n M-5 select-window -t :5
bind -n M-6 select-window -t :6
bind -n M-7 select-window -t :7
bind -n M-8 select-window -t :8
bind -n M-9 select-window -t :9
bind -n M-t new-window -c "#{pane_current_path}"
bind -n M-Q kill-window
bind -n M-n command-prompt "rename-window '%%'"
bind -n M-T break-pane -a
bind -n M-M join-pane -h -t :-

# Session actions
bind S choose-session
bind ] switch-client -n
bind [ switch-client -p
bind A new
bind N command-prompt "rename-session '%%'"
bind M-f choose-tree

# Neovim integration
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?\.?(view|n?vim?x?)(-wrapped)?(diff)?$'"
bind -n 'M-h' if-shell "$is_vim" 'send-keys M-h' 'select-pane -L'
bind -n 'M-j' if-shell "$is_vim" 'send-keys M-j' 'select-pane -D'
bind -n 'M-k' if-shell "$is_vim" 'send-keys M-k' 'select-pane -U'
bind -n 'M-l' if-shell "$is_vim" 'send-keys M-l' 'select-pane -R'
bind -n 'M-H' if-shell "$is_vim" 'send-keys M-H' "run-shell 'tmux resize-pane -x $((#{pane_width} - 3))'"
bind -n 'M-J' if-shell "$is_vim" 'send-keys M-J' "run-shell 'tmux resize-pane -y $((#{pane_height} - 1))'"
bind -n 'M-K' if-shell "$is_vim" 'send-keys M-K' "run-shell 'tmux resize-pane -y $((#{pane_height} + 1))'"
bind -n 'M-L' if-shell "$is_vim" 'send-keys M-L' "run-shell 'tmux resize-pane -x $((#{pane_width} + 3))'"
# bind -T copy-mode-vi 'M-h' select-pane -L
# bind -T copy-mode-vi 'M-j' select-pane -D
# bind -T copy-mode-vi 'M-k' select-pane -U
# bind -T copy-mode-vi 'M-l' select-pane -R
# bind -T copy-mode-vi M-H resize-pane -L 3
# bind -T copy-mode-vi M-J resize-pane -D 1
# bind -T copy-mode-vi M-K resize-pane -U 1
# bind -T copy-mode-vi M-L resize-pane -R 3

# Status-bar
set -g status-interval 1
set -g status-position top
set -g status-left ""
set -g status-right " Session: [#S] "
set -g status-justify left
set -g window-status-format " #I:[#W] "
set -g window-status-current-format " #I:[#W] "
set -g window-status-separator ""
set -wg automatic-rename on
set -g automatic-rename-format '#{b:pane_current_path}'

# Colors
set -g status-style "fg=white bg=black"
set -g status-left-style "fg=black bg=white"
set -g status-right-style "fg=black bg=white"
set -g message-style "fg=black bg=white"
set -g mode-style "fg=black bg=white reverse"
set -g pane-border-style "fg=black bg=black"
set -g pane-active-border-style "fg=white bg=white"
setw -g window-status-style "fg=white bg=black"
setw -g window-status-current-style "fg=black bg=white"
