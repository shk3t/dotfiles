bindkey -v           # turn on vim bindings
export KEYTIMEOUT=1  # no delay before mode change

# Go to insert mode on each new prompt
zle-line-init() {
    zle -K viins
    echo -ne "\e[6 q"
}
zle -N zle-line-init
# Change cursor shape for different vi modes.
function zle-keymap-select () {
    case $KEYMAP in
        vicmd) echo -ne '\e[2 q';;      # block
        viins|main) echo -ne '\e[6 q';; # beam
    esac
}
zle -N zle-keymap-select

# Autosuggestions integration
[[ $KEYMAP = vicmd ]] && (( max++ ))

# Enable quote text-objects
autoload -U select-quoted
zle -N select-quoted
for m in visual viopp; do
    for c in {a,i}{\',\",\`}; do
        bindkey -M $m $c select-quoted
    done
done
