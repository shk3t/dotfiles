# Stty
stty stop undef  # disable ctrl-s to freeze terminal.
stty start undef
stty susp "^Z"
stty intr "^C"
stty werase "^H"

# Navigation
bindkey "^[[D" backward-char
bindkey "^[[C" forward-char
bindkey "^[[1;5D" backward-word
bindkey "^[[1;5C" forward-word
bindkey "^[[1~" beginning-of-line
bindkey "^[[4~" end-of-line
bindkey "^P" up-history
bindkey "^N" down-history

# Editing
bindkey "^[[3~" delete-char
bindkey "^[[3;5~" kill-word
bindkey "^?" backward-delete-char
bindkey "^W" backward-kill-word
function insert-newline() {
    LBUFFER+=$'\n'
}
zle -N insert-newline
bindkey "^[[13;2u" insert-newline

# Vim bindings
bindkey -rM vicmd ":"
bindkey -M vicmd "k" up-line
bindkey -M vicmd "j" down-line
bindkey -M vicmd "^[[1;5D" backward-word
bindkey -M vicmd "^[[1;5C" forward-word

# Completion menu
bindkey -M menuselect "^M" .accept-line
bindkey -M menuselect "^[" vi-cmd-mode
bindkey -M menuselect "^K" up-history
bindkey -M menuselect "^[[9;2u" up-history
bindkey -M menuselect "^[[Z" up-history
bindkey -M menuselect "^J" down-history
bindkey -M menuselect "^H" backward-char
bindkey -M menuselect "^L" forward-char

# Fast exit
exit_zsh() { exit }
zle -N exit_zsh
bindkey '^Q' exit_zsh
bindkey -M vicmd '^Q' exit_zsh

# Interrupt completion
function interrupt-completion {
    if [[ $COMPLETION_ACTIVE == 1 ]]; then
        COMPLETION_ACTIVE=0
        zle -M "Completion canceled."            
        return 1
    else
        return 0
    fi
}
zle -N interrupt-completion
bindkey '^E' interrupt-completion

# Autosuggestions
function autosuggest-accept-line() {
    zle autosuggest-accept
    zle accept-line
}
zle -N autosuggest-accept-line
bindkey "^L" autosuggest-accept-line
# Widgets update: https://github.com/zsh-users/zsh-autosuggestions/blob/master/src/config.zsh
ZSH_AUTOSUGGEST_ACCEPT_WIDGETS=(
    forward-char
    end-of-line
    vi-forward-char
    vi-end-of-line
    vi-add-eol
    autosuggest-accept-line
)
ZSH_AUTOSUGGEST_PARTIAL_ACCEPT_WIDGETS=(
    forward-word
    emacs-forward-word
    vi-forward-word
    vi-forward-word-end
    vi-forward-blank-word
    vi-forward-blank-word-end
    vi-find-next-char
    vi-find-next-char-skip
)
