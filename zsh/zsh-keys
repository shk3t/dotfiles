# Key bindings
bindkey -s "^E" "nvim .^M"
bindkey -s "^F" "nvim . -c 'Telescope find_files'^M"
bindkey -s "^G" "nvim . -c 'Telescope live_grep'^M"
bindkey "^C" vi-cmd-mode
bindkey "^L" autosuggest-accept
bindkey "^S" autosuggest-toggle
bindkey "^?" backward-delete-char
bindkey "^H" backward-kill-word
bindkey "^[[3;5~" kill-word
bindkey "^[[1;5C" forward-word
bindkey "^[[1;5D" backward-word
bindkey "^P" up-history
bindkey "^N" down-history
bindkey "^K" up-history
bindkey "^J" down-history

# Stty
stty stop undef  # disable ctrl-s to freeze terminal.
stty start undef
stty intr "^Q"
stty werase "^H"

# Completion menu movements
bindkey -M menuselect "^J" vi-down-line-or-history
bindkey -M menuselect "^K" vi-up-line-or-history
bindkey -M menuselect "^H" vi-backward-char
bindkey -M menuselect "^L" vi-forward-char
bindkey -M menuselect "^[[Z" vi-up-line-or-history
bindkey -M menuselect "^M" .accept-line
# bindkey -M menuselect "^L" accept-line
bindkey -M menuselect "^[" vi-cmd-mode

# Vim bindings
bindkey -M viins "^?" backward-delete-char
bindkey -M visual -s "^C" "^["
bindkey -M vicmd "^[[1;5C" forward-word
bindkey -M vicmd "^[[1;5D" backward-word
bindkey -M vicmd "^K" up-history
bindkey -M vicmd "^J" down-history
bindkey -M vicmd "j" down-line
bindkey -M vicmd "k" up-line
bindkey -M vicmd "^S" autosuggest-toggle
bindkey -rM vicmd ":"

# Yank to the system clipboard
function vi-yank-xclip() {
    zle vi-yank
    echo -n "$CUTBUFFER" | xclip -selection clipboard
}
zle -N vi-yank-xclip
bindkey -M vicmd "\x1b[67;6u" vi-yank-xclip
#bindkey -M vicmd "y" vi-yank-xclip

## Paste from the system clipboard
#function vi-paste-xclip-before() {
#    CLIP_DATA=$(xclip -selection clipboard -out)
#    LBUFFER="$LBUFFER${CLIP_DATA[1,-2]}"
#    RBUFFER="${CLIP_DATA[-1]}$RBUFFER"
#}
#function vi-paste-xclip-after() {
#    CLIP_DATA=$(xclip -selection clipboard -out)
#    LBUFFER="$LBUFFER${RBUFFER[1]}${CLIP_DATA[1,-2]}"
#    RBUFFER="${CLIP_DATA[-1]}${RBUFFER[2,-1]}"
#}
#zle -N vi-paste-xclip-before
#zle -N vi-paste-xclip-after
#bindkey -M vicmd "P" vi-paste-xclip-before
#bindkey -M vicmd "p" vi-paste-xclip-after

# Yank current line
function yank-current-line-xclip() {
    zle visual-line-mode
    zle vi-yank-xclip
}
zle -N yank-current-line-xclip
bindkey '^Y' yank-current-line-xclip
